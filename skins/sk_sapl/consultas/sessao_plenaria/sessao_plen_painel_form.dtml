<!DOCTYPE html>
<html lang="pt-br">
<head>
<dtml-var standard_css_slot>
</head>
<body>

<dtml-call expr="REQUEST.set('cod_ordem', cod_ordem)">

<dtml-call expr="REQUEST.set('cod_sessao_plen', cod_sessao_plen)">

<h1 class="firstHeading">Sessão Plenária</h1>

<h3 align="center"><dtml-var sessao_plenaria_header></h3>

<fieldset>
  <legend>Painel de Votação</legend>
    <table>
      <dtml-if expr="tipo_materia == 'expediente'">
       <dtml-call expr="REQUEST.set('zsqlmethod',zsql.votacao_expediente_materia_obter_zsql)">
      <dtml-else>
       <dtml-call expr="REQUEST.set('zsqlmethod',zsql.votacao_ordem_dia_obter_zsql)">
      </dtml-if>
        <dtml-in expr="zsqlmethod(cod_ordem = cod_ordem, ind_excluido=0)">
        <dtml-in expr="zsql.materia_obter_zsql(cod_materia=cod_materia, ind_excluido=0)">
        <tr>
            <th class="texto">
                <b>Matéria</b>: <dtml-var sgl_tipo_materia missing> <dtml-var num_ident_basica missing>/<dtml-var ano_ident_basica missing> - <dtml-var des_tipo_materia missing> <br />
                <b>Ementa</b>: <dtml-var txt_ementa>
            </th>
        </tr>
        <tr>
            <td class="texto">
                <b>Resultado da Votação</b>: 
                <dtml-in expr="zsql.tipo_resultado_votacao_obter_zsql(tip_resultado_votacao=tip_resultado_votacao)">
                    <dtml-var nom_resultado>
                </dtml-in>
            </td>
        </tr>
        <tr>
            <td class="texto">
                <b>Quantidade de votos não:</b> <dtml-var num_votos_nao>
            </td>
        </tr>
        <tr>
            <td class="texto">
                <b>Quantidade de votos sim:</b> <dtml-var num_votos_sim>
            </td>
        </tr>
        <tr>
            <td class="texto">
                <b>Quantidade de abstenções:</b> <dtml-var num_abstencao>
            </td>
        </tr>
        </dtml-in>
        </dtml-in>
     </table>
    </fieldset>
    <fieldset>
    <legend>Votação</legend>
        <table>
        <tr>
            <th width="50%" class="label">Parlamentar / Partido</th>
            <th width="50%" class="label">Votação (Sim / Não / Abstenção)
            </th>
        </tr>
        <dtml-in expr="zsql.presenca_ordem_dia_obter_zsql(dat_ordem = pysc.data_converter_pysc
(data=dat_inicio_sessao),cod_sessao_plen=cod_sessao_plen, ind_excluido=0)">
        <dtml-in expr="zsql.parlamentar_obter_zsql(cod_parlamentar=cod_parlamentar, ind_excluido=0)">
        <tr>
            <td class="texto">
                <dtml-var nom_completo> / <dtml-var sgl_partido missing null="">
            </td>
            <td class="texto">
            <dtml-call expr="REQUEST.set('voto', 0)">
            <dtml-if expr="tipo_materia == 'expediente'">
             <dtml-call expr="REQUEST.set('zsqlmethod',zsql.votacao_expediente_materia_obter_zsql)">
            <dtml-else>
             <dtml-call expr="REQUEST.set('zsqlmethod',zsql.votacao_ordem_dia_obter_zsql)">
            </dtml-if>
            <dtml-in expr="zsqlmethod(cod_ordem = cod_ordem, ind_excluido=0)">
            <dtml-in expr="zsql.votacao_obter_zsql(cod_materia = cod_materia, cod_ordem = cod_ordem, ind_excluido=0)">
            <dtml-in expr="zsql.votacao_parlamentar_obter_zsql(cod_votacao = cod_votacao, cod_parlamentar = cod_parlamentar, ind_excluido=0)">        
            <span>
                <dtml-if expr="vot_parlamentar!='-1'">
                   <dtml-var vot_parlamentar>
                   <dtml-call expr="REQUEST.set('voto', 1)">
                </dtml-if>
            </span>
            </dtml-in>
            </dtml-in>
            </dtml-in>
            <dtml-unless voto>
                <span>Sem voto registrado</span>            
            </dtml-unless>
            </td>
        </tr>
        </dtml-in>
        </dtml-in>
        </table>
    </fieldset>

  <p align="center">
   <input class="botao" type="button" value="Fechar" OnClick="javascript:parent.jQuery.fancybox.close();" />
  </p>
</body>
</html>
